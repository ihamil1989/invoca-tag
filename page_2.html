<!DOCTYPE HTML>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NPZ9PM89');</script>
    <!-- End Google Tag Manager -->
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Call me!</title>

    <!-- Invoca Tag (If not already loaded via GTM or another method) -->
    <script src="https://tag.invoca.net/your-invoca-id.js"></script>

    <script>
        // Function to extract query parameters from the URL
        function getQueryParams() {
            let params = new URLSearchParams(window.location.search);
            let queryParams = {};

            params.forEach((value, key) => {
                queryParams[key] = value;
            });

            return queryParams;
        }

        // Function to display query parameters on the page
        function displayQueryParams() {
            let queryParams = getQueryParams();
            let displayArea = document.getElementById("queryParamsDisplay");

            displayArea.innerHTML = "";

            if (Object.keys(queryParams).length > 0) {
                Object.entries(queryParams).forEach(([key, value]) => {
                    let p = document.createElement("p");
                    p.textContent = `${key}: ${value}`;
                    displayArea.appendChild(p);
                });
            } else {
                displayArea.innerHTML = "<p><strong>No query parameters found.</strong></p>";
            }
        }

        // Function to track when a call is completed in Invoca
        function trackInvocaCallCompletion() {
            if (window.invocaTag && window.invocaTag.getCallData) {
                window.invocaTag.getCallData(function(callData) {
                    console.log("Call Completed:", callData);

                    // Push call data to GTM
                    window.dataLayer = window.dataLayer || [];
                    window.dataLayer.push({
                        'event': 'invoca_call_completed',
                        'phone_number': callData.phone_number,
                        'call_duration': callData.call_duration, // Duration in seconds
                        'utm_medium': new URLSearchParams(window.location.search).get('utm_medium') || "unknown",
                        'utm_source': new URLSearchParams(window.location.search).get('utm_source') || "unknown"
                    });

                    console.log("GTM Call Data Sent:", {
                        'phone_number': callData.phone_number,
                        'call_duration': callData.call_duration
                    });
                });
            } else {
                console.error("Invoca tag not found or call data unavailable.");
            }
        }

        // Listen for Invoca's call completion event
        document.addEventListener("DOMContentLoaded", function() {
            displayQueryParams();

            if (window.invocaTag) {
                window.invocaTag.on('call_completed', trackInvocaCallCompletion);
            }
        });
    </script>
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NPZ9PM89"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <h1>Call the number below for customer support.</h1>
    <a href="tel:+5555555555" style="color: blue; font-weight:bold;">555-555-5555</a>

    <h1>Call the number below for a free quote!</h1>
    <a href="tel:+2222222222" style="color: blue; font-weight:bold;">222-222-2222</a>

    <h2>Captured Query Parameters:</h2>
    <div id="queryParamsDisplay">
        <p>Loading parameters...</p>
    </div>
</body>
</html>
